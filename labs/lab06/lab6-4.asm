%include "in_out.asm"        ; подключаем библиотеку с готовыми процедурами ввода/вывода

SECTION .data
m1: DB "Вычисляем выражение: f(x) = (2 + x)^2", 0    ; строка с текстом выражения
m2: DB "Введите значение x: ", 0                     ; строка для запроса ввода
m3: DB "Результат f(x) = ", 0                        ; строка для вывода результата

SECTION .bss
x: RESB 80                                           ; резервируем место под ввод числа

SECTION .text
GLOBAL _start
_start:

    mov eax, m1          ; загружаем адрес первой строки (описание выражения)
    call sprintLF        ; выводим её на экран и переходим на новую строку

    mov eax, m2          ; загружаем адрес строки с приглашением к вводу
    call sprint          ; выводим её на экран (без перехода на новую строку)

    mov ecx, x           ; адрес буфера, куда запишется ввод пользователя
    mov edx, 80          ; максимальное количество символов для ввода
    call sread           ; читаем введённую строку (число x)

    mov eax, x           ; помещаем адрес введённой строки в eax
    call atoi            ; преобразуем строку в число, результат в eax

    add eax, 2           ; к введённому x прибавляем 2 → (2 + x)
    mov ebx, eax         ; сохраняем (2 + x) в ebx
    mul ebx              ; умножаем (2 + x) * (2 + x), результат в eax

    mov edi, eax         ; сохраняем результат в edi для вывода
    mov eax, m3          ; загружаем адрес строки с подписью результата
    call sprint           ; выводим "Результат f(x) = "
    mov eax, edi         ; помещаем вычисленное значение в eax
    call iprintLF        ; выводим число и переходим на новую строку

    call quit            ; завершаем программу
